<html>
  <head>
    <title>spiider34</title>
    <link
      rel="icon"
      herf="https://i.ibb.co/3NJzN7D/ezgif-com-gif-maker-2.png"
    />
  </head>
  <body>
    <style>
      body {
        text-align: center;
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 1px;
        background-color: #add8e6;
      }

      img {
        display: block;
        margin-left: auto;
        margin-right: auto;
        max-width: 99%;
        max-height: 99%;
      }

      .wrapper {
        padding: 5px;
        font-family: Arial, Helvetica, sans-serif;
      }

      .galleryItem {
        width: 100%;
        height: 100%;
        object-fit: scale-down;
      }

      .gallery {
        z-index: 2;
        background: rgba(105,105,105, 0.75);
        position: absolute;
        display: grid;
        grid-template-columns: auto auto auto;
      }
    </style>
    <img
      src="https://cdn.glitch.global/38681b80-02c2-4aec-bed4-f79cdfdda113/wallpaper.svg?v=1663801406336"
      id="img"
    />
    
    <div class="gallery" style="visibility: hidden;"></div>

    <p class="wrapper">
      <strong>spiider34 is a better way to consume rule34 content!</strong>
    </p>
    <div class="wrapper">
      <input
        type="text"
        placeholder="daddy's finder..."
        id="search"
        size="30"
        autocomplete="off"
        value="star_wars"
      />
    </div>

    <script>
      const leftArrow = 37;
      const rightArrow = 39;
      const enter = 13;

      var tagData = [];
      var idx = 0;

      addEvent(document, "keydown", function (e) {
        e = e || window.event;
        console.log(e.keyCode);

        if (e.keyCode === enter) {
          fetch(
            `https://r34-json-api.herokuapp.com/posts?tags=${
              document.getElementById("search").value
            }`
          )
            .then((response) => response.json())
            .then((data) => {
              tagData = data;
              idx = 0;

              setActiveImg(tagData[idx].file_url);
            
              for (var i = 0; i < tagData.length; i++) {
                const figure = document.createElement("figure")
                const img = document.createElement("img")
                
                img.class = "galleryItem"
                img.src = tagData[i].preview_url
                
                figure.appendChild(img)
                document.getElementsByClassName("gallery")[0].appendChild(figure)
              }
            });
        } else if (e.keyCode === leftArrow) {
          if (idx > 0) {
            idx = idx - 1;
            console.log(idx);
            setActiveImg(tagData[idx].file_url);
          }
        } else if (e.keyCode === rightArrow) {
          if (idx <= tagData.length + 1) {
            idx = idx + 1;
            setActiveImg(tagData[idx].file_url);
          }
        }
      });

      function setActiveImg(url) {
        console.log(url);
        var image = document.getElementById("img");
        image.src = url;
      }

      function addEvent(element, eventName, callback) {
        if (element.addEventListener) {
          element.addEventListener(eventName, callback, false);
        } else if (element.attachEvent) {
          element.attachEvent("on" + eventName, callback);
        } else {
          element["on" + eventName] = callback;
        }
      }
    </script>
    
    <figure style="visibility: hidden;" id="figure">
        <img
          class="galleryItem"
          src="https://cdn.glitch.global/38681b80-02c2-4aec-bed4-f79cdfdda113/wallpaper.svg?v=1663801406336"
        />
      </figure>
  </body>
</html>
